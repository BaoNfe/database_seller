<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Product CRUD</title>
</head>

<body>
  <h1>Product CRUD Operations</h1>

  <h2>Create Product</h2>
  <form id="createForm">
    <label for="title">Title:</label>
    <input type="text" id="title" name="title" required><br>

    <label for="description">Description:</label>
    <input type="text" id="description" name="description" required><br>

    <label for="price">Price:</label>
    <input type="number" id="price" name="price" step="0.01" required><br>

    <label for="image">Image URL:</label>
    <input type="text" id="image" name="image" required><br>

    <label for="length">Length:</label>
    <input type="number" id="length" name="length" required><br>

    <label for="width">Width:</label>
    <input type="number" id="width" name="width" required><br>

    <label for="height">Height:</label>
    <input type="number" id="height" name="height" required><br>

    <label for="category">Category:</label>
    <input type="text" id="category" name="category" required><br>


    <button type="submit">Create Product</button>
  </form>

  <h2>Read Product</h2>
  <form id="readForm">
    <label for="productId">Product ID:</label>
    <input type="text" id="productId" name="productId" required><br>
    <button type="submit">Read Product</button>
  </form>

  <h2>Update Product</h2>
  <form id="updateForm">
    <label for="title">Title:</label>
    <input type="text" id="title" name="title" required><br>

    <label for="description">Description:</label>
    <input type="text" id="description" name="description" required><br>

    <label for="price">Price:</label>
    <input type="number" id="price" name="price" step="0.01" required><br>

    <label for="image">Image URL:</label>
    <input type="text" id="image" name="image" required><br>

    <label for="length">Length:</label>
    <input type="number" id="length" name="length" required><br>

    <label for="width">Width:</label>
    <input type="number" id="width" name="width" required><br>

    <label for="height">Height:</label>
    <input type="number" id="height" name="height" required><br>

    <label for="category">Category:</label>
    <input type="text" id="category" name="category" required><br>

    <button type="submit">Update Product</button>
  </form>

  <h2>Delete Product</h2>
  <form id="deleteForm">
    <label for="deleteProductId">Product ID to Delete:</label>
    <input type="text" id="deleteProductId" name="deleteProductId" required><br>
    <button type="submit">Delete Product</button>
  </form>

  <div id="result"></div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const createForm = document.getElementById('createForm');
      const readForm = document.getElementById('readForm');
      const updateForm = document.getElementById('updateForm');
      const deleteForm = document.getElementById('deleteForm');
      const resultDiv = document.getElementById('result');

      createForm.addEventListener('submit', async (event) => {
        event.preventDefault();

        const formData = new FormData(createForm);
        const product = {};
        formData.forEach((value, key) => {
          product[key] = value;
        });

        try {
          const response = await fetch('/create', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(product)
          });

          const data = await response.json();
          resultDiv.textContent = `Product created with ID: ${data.insertedId}`;
        } catch (error) {
          resultDiv.textContent = 'An error occurred while creating the product.';
        }
      });

      readForm.addEventListener('submit', async (event) => {
        event.preventDefault();

        const productId = readForm.querySelector('#productId').value;
        try {
          const response = await fetch(`/read/${productId}`);
          const product = await response.json();
          // Display product details in the resultDiv
          resultDiv.textContent = JSON.stringify(product, null, 2);
        } catch (error) {
          resultDiv.textContent = 'An error occurred while reading the product.';
        }
      });

      updateForm.addEventListener('submit', async (event) => {
        event.preventDefault();

        const formData = new FormData(updateForm);
        const product = {};
        formData.forEach((value, key) => {
          product[key] = value;
        });

        try {
          const productId = product._id; 
          delete product._id; 
          const response = await fetch(`/update/${productId}`, {
            method: 'PUT',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(product),
          });

          const data = await response.json();
          resultDiv.textContent = `Product updated with ID: ${productId}`;
        } catch (error) {
          resultDiv.textContent = 'An error occurred while updating the product.';
        }
      });

      deleteForm.addEventListener('submit', async (event) => {
        event.preventDefault();

        const productIdToDelete = deleteForm.querySelector('#deleteProductId').value;

        try {
          const response = await fetch(`/delete/${productIdToDelete}`, {
            method: 'DELETE',
          });

          const data = await response.json();
          resultDiv.textContent = `Product deleted with ID: ${productIdToDelete}`;
        } catch (error) {
          resultDiv.textContent = 'An error occurred while deleting the product.';
        }
      });

    });
  </script>
</body>

</html>